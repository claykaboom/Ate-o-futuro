<template>
  <layout-default>
    <vue-headful
      title="At√© o Futuro  - Teste sua Empregabilidade ‚öî‚ö° - Mentoria Gratuita"
      description="Mentoria Gratuita"
    />
    <div class="box">
      <h1 class="title is-3">üìÖ Agende seu Processo Seletivo + Mentoria</h1>
      <h2 class="subtitle is-3">
        Fa√ßa um simulado e teste sua empregabilidade  
      </h2> 
      <div class="columns">
        <div class="column is-6">
          <h3 class="subtitle is-3">
            <b-icon icon="account" size="large" /> Seus dados
          </h3>

          <b-field label="Nome" label-position="on-border">
            <b-input
              v-model="name"
              placeholder="Seu nome Aqui"
              :message="nameErrorMessage"
              :type="nameErrorMessage ? 'is-danger' : ''"
            ></b-input>
          </b-field>
          <b-field
            label="Email"
            label-position="on-border"
            :type="emailErrorMessage ? 'is-danger' : ''"
          >
            <b-input
              type="email"
              placeholder="seuEmail@provedor.com"
              v-model="email"
              icon="email"
              maxlength="150"
              :message="emailErrorMessage"
            >
            </b-input>
          </b-field>
          <b-field
            expanded
            label="Situa√ß√£o profissional"
            label-position="on-border"
            v-model="situacaoProfissional"
          >
            <b-select
              placeholder="Indique seu momento profissional"
              v-model="situacaoProfissional"
            >
              <option
                value="Desempregado(a) - Procurando emprego em √°rea de experi√™ncia"
              >
                Desempregado(a) - Procurando emprego em √°rea de experi√™ncia
              </option>
              <option
                value="Desempregado(a) - Procurando mudar de carreira ou o primeiro
                emprego"
              >
                Desempregado(a) - Procurando mudar de carreira ou o primeiro
                emprego
              </option>
              <option
                value="Empregado(a) - Procurando mais visibilidade no mercado"
              >
                Empregado(a) - Procurando mais visibilidade no mercado
              </option>
              <option value="Empregado(a) - Procurando promo√ß√£o">
                Empregado(a) - Procurando promo√ß√£o
              </option>
              <option
                value="Empregado(a) - Procurando mudar de carreira (outra √°rea)"
              >
                Empregado(a) - Procurando mudar de carreira (outra √°rea)
              </option>
              <option
                value="Empregado(a) - Procurando mudar de emprego na mesma √°rea"
              >
                Empregado(a) - Procurando mudar de emprego na mesma √°rea
              </option>
              <option value="Empregado(a) - Valida√ß√£o da minha empregabilidade">
                Empregado(a) - Valida√ß√£o da minha empregabilidade
              </option>
              <option value="Outra">Outra</option>
            </b-select>
          </b-field>

          <b-field label="Informa√ß√µes adicionais" label-position="on-border">
            <b-input
              maxlength="200"
              type="textarea"
              v-model="infoAdicional"
            ></b-input>
          </b-field>

          <b-field
            label="WhatsApp para Notifica√ß√µes (opcional)"
            label-position="on-border"
          >
            <b-input
              placeholder="+5511XXXXX-XXXX"
              type="phone"
              icon="phone"
              v-cleave="masks.phone"
              v-model="whatsAppNumber"
            ></b-input>
          </b-field>
          <b-field
            label="URL de alguma vaga de interesse (opcional)"
            type="url"
            label-position="on-border"
          >
            <b-input
              v-model="URLVaga"
              expanded
              icon="link"
              placeholder="Vaga de interesse"
            ></b-input>
          </b-field>

          <b-field
            label="URL do seu Curriculum ou Linkedin (opcional)"
            label-position="on-border"
          >
            <b-input
              v-model="linkedInURL"
              expanded
              icon="linkedin"
              placeholder="Como podemos te conhecer melhor"
            ></b-input>
          </b-field>
          <br />
          <b
            >üìç Se voc√™ compartilhar uma vaga na qual voc√™ tem interesse e seu
            hist√≥rico profissinal, poderemos customizar a sua experi√™ncia.</b
          >
          <br />
          <br />
          <b-field label="Melhores dias da semana para sua entrevista">
            <div class="block">
              <b-checkbox v-model="diasSemana" native-value="Segunda-Feira">
                Segunda-Feira
              </b-checkbox>
              <b-checkbox v-model="diasSemana" native-value="Ter√ßa-Feira">
                Ter√ßa-Feira
              </b-checkbox>
              <b-checkbox v-model="diasSemana" native-value="Quarta-Feira">
                Quarta-Feira
              </b-checkbox>
              <b-checkbox v-model="diasSemana" native-value="Quinta-Feira">
                Quinta-Feira
              </b-checkbox>
              <b-checkbox v-model="diasSemana" native-value="Sexta-Feira">
                Sexta-Feira
              </b-checkbox>
              <b-checkbox v-model="diasSemana" native-value="S√°bado">
                S√°bado
              </b-checkbox>
              <b-checkbox v-model="diasSemana" native-value="Domingo">
                Domingo
              </b-checkbox>
            </div>
          </b-field>
          <br />

          ‚ùó Vamos mandar algumas propostas de datas MAIS PR√ìXIMAS da sua
          prefer√™ncia o poss√≠vel. Entenda que temos uma fila de interessados e
          vamos gerenciando a fila caso haja desist√™ncias.
          <br />
          <br />

          <b-checkbox
            size="is-small"
            type="is-success"
            v-model="consentimentoPrivacidade"
            native-value="Concordo com os termos de privacidade"
          >
            Eu concordo com os usos de meus dados pessoais somente para
            finalidade da entrevista + mentoria, podendo pedir a elimina√ß√£o dos
            meus dados a qualquer momento. Concordo com a
            <router-link  :to="{ name: 'Privacidade' }" 
              >Pol√≠tica de Privacidade do At√© o Futuro</router-link
            >
          </b-checkbox>
          <br />
          <br />

          <b-button
            size="is-large"
            :disabled="!consentimentoPrivacidade"
            type="is-success"
            @click="save()"
            >Agendar ‚ö°</b-button
          >
        </div>
        <!-- <div class="column is-5">
              <h2 class="subtitle is-3">
            <b-icon icon="calendar" size="large" /> Escolha a data e hora
          </h2>
          <b-table
            :data="availableAgenda"
            :bordered="true"
            :striped="true"
            :narrowed="true"
            :hoverable="true"
            :loading="$store.state.isLoading"
            :focusable="false"
            :mobile-cards="false"
          >
            <b-table-column field="id" label="Id" v-slot="props">
              {{ props.row.id }}
            </b-table-column>
            <b-table-column field="data" label="Data" v-slot="props">
              {{ props.row.Data | moment("DD/MM/YYYY HH:mm") }}
            </b-table-column>
          </b-table>
        </div> -->
        <div
          class="column is-6"
          style="
            background: url('https://source.unsplash.com/featured/?colorful creative');
            background-attachment: fixed;
            background-position: center;
            background-repeat: no-repeat;
            background-size: cover;
          "
        >
          <div class="box">
            <h2 class="subtitle is-3">üöÄ Como funciona?</h2>

            <section class="hero is-primary">
              <div class="hero-body">
                <p class="title">VAGAS LIMITADAS! üèÉ‚Äç‚ôÇÔ∏èüèÉüèΩ‚Äç‚ôÄÔ∏è</p>
                <p class="subtitle">
                  GR√ÅTIS. DE VERDADE. Aproveite agora sua chance de validar sua
                  empregabilidade com pessoas de confian√ßa e ajude-nos com esse
                  experimento!
                </p>
              </div>
            </section>

            <br />
            <b>1Ô∏è‚É£</b> Assim que voc√™ registrar seu interesse, vamos mandar
            sugest√µes de datas para voc√™ escolher e agendar a sua simula√ß√£o de
            processo seletivo!
            <br />
            <br />

            <b> 2Ô∏è‚É£</b> Nessa entrevista vamos exercitar suas fortalezas,
            identificar suas vulnerabilidades, e fazer uma reflex√£o
            especializada sobre sua performance!

            <br />
            <br />

            <b>3Ô∏è‚É£</b> Se voc√™ desejar podemos compartilhar o resultado de sua
            entrevista com nossos parceiros, como um suporte para sua jornada de
            aperfei√ßoamento.

            <br />
            <br />

            <b>
              4Ô∏è‚É£ O nosso objetivo √© ajudar voc√™ a fazer a travessia desse rio
              que separa seu EU PRESENTE do seu EU FUTURO.</b
            >
            <br />
            <br />

            <b>
              5Ô∏è‚É£ ü§î Se estiver em d√∫vidas sobre quem somos, conhe√ßa-nos mais em
              <router-link :to="{ name: 'Experts' }">
                nossa p√°gina de Experts</router-link
              ></b
            >
            <br />
            <br />

            <b> 6Ô∏è‚É£</b> Sempre atente-se
            <router-link :to="{ name: 'Privacidade' }">
              √†s pol√≠ticas de privacidade.
            </router-link>
            Aqui armazenamos seus dados para prop√≥sitos de qualidade e de acordo
            com a Lei Geral de Prote√ß√£o de Dados.

            <br />
            <br />

            <!-- 5Ô∏è‚É£6Ô∏è‚É£7Ô∏è‚É£8Ô∏è‚É£9Ô∏è‚É£üîü -->

            <video autoplay muted loop id="myVideo">
              <source src="@/assets/Empregabilidade.mp4" type="video/mp4" />
            </video>
          </div>
        </div>
      </div>
    </div>
  </layout-default>
</template>


<script>
import firebase from "firebase";
require("cleave.js/dist/addons/cleave-phone.br");
import Cleave from "cleave.js";

const cleave = {
  name: "cleave",
  bind(el, binding) {
    const input = el.querySelector("input");
    input._vCleave = new Cleave(input, binding.value);
  },
  unbind(el) {
    const input = el.querySelector("input");
    input._vCleave.destroy();
  },
};

export default {
  directives: { cleave },
  data() {
    return {
      dataEvento: new Date(),
      showWeekNumber: false,
      enableSeconds: false,
      hourFormat: "24", // Browser locale
      locale: "pt-BR", // Browser locale
      availableAgenda: [],
      whatsAppNumber: null,
      linkedInURL: null,
      name: null,
      email: null,
      URLVaga: null,
      diasSemana: [],
      situacaoProfissional: null,
      infoAdicional: null,
      InviterCode: null,
      consentimentoPrivacidade: false,
      masks: {
        phone: {
          phone: true,
          phoneRegionCode: "BR",
        },
      },
    };
  },
  mounted() {
    var thisVM = this;
    thisVM.InviterCode = thisVM.$route.params.InviterCode;
    if (thisVM.$store.state.currentUser != null) {
      thisVM.name = thisVM.$store.state.currentUser.displayName;
      thisVM.email = thisVM.$store.state.currentUser.email;
    }
  },
  computed: {
    emailErrorMessage() {
      if (this.email == null || this.email == "") {
        return "E-mail inv√°lido";
      }

      return null;
    },
    whatsAppErrorMessage() {
      if (this.whatsAppNumber == null || this.whatsAppNumber == "") {
        return "Telefone inv√°lido";
      }

      return null;
    },
    nameErrorMessage() {
      if (this.name == null || this.name == "")
        return "Informe seu nome, por favor";
      return null;
    },
  },
  methods: {
    save() {
      var thisVM = this;
      const re = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
      var isValidEmail =
        thisVM.email != null && re.test(String(this.email).toLowerCase());
      var isValidWhatsApp =
        thisVM.whatsAppNumber != null &&
        thisVM.whatsAppNumber.replaceAll(" ", "").length >= 8;
      if (
        thisVM.nameErrorMessage != null ||
        (thisVM.emailErrorMessage != null &&
          thisVM.whatsAppErrorMessage != null)
      ) {
        this.$buefy.dialog.alert({
          message:
            "üò¢ Ops! Precisamos pelo menos de seu nome e de uma informa√ß√£o de contato (e-mail ou whatsapp)",
          onConfirm: () => {
            this.$buefy.toast.open(
              `Preencha todos os campos para entrar em contato`
            );
          },
        });
      } else {
        if (thisVM.email != null && thisVM.email != "" && !isValidEmail) {
          this.$buefy.dialog.alert({
            message: "üò¢ Ops! Parece que esse e-mail n√£o est√° legal.",
            onConfirm: () => {
              this.$buefy.toast.open(`Ops! E-mail inv√°lido`);
            },
          });
        } else if (thisVM.whatsAppNumber != null && !isValidWhatsApp) {
          this.$buefy.dialog.alert({
            message:
              "üò¢ Ops! Parece que seu n√∫mero do WhatsApp n√£o est√° completo.",
            onConfirm: () => {
              this.$buefy.toast.open(`Ops! Whats App n√£o parece certo!`);
            },
          });
        } else if (thisVM.situacaoProfissional == null) {
          this.$buefy.dialog.alert({
            message:
              "üî® Voc√™ pode indicar a sua situa√ß√£o profissional, por favor? Isso vai ajudar a gente a personalizar a sua experi√™ncia conosco.",
            onConfirm: () => {
              this.$buefy.toast.open(`Indique a situa√ß√£o profissional.`);
            },
          });
        } else {
          var newInterviewRequestID = firebase
            .database()
            .ref()
            .child(`/InterviewRequests/${newInterviewRequestID}`)
            .push().key;

          var LoggedUserId = null;
          var LoggedUserName = null;
          var LoggedCreatedByUserEmail = null;

          if (thisVM.$store.state.currentUser) {
            LoggedUserId = thisVM.$store.state.currentUser.uid;
            LoggedUserName = thisVM.$store.state.currentUser.displayName;
            LoggedCreatedByUserEmail = thisVM.$store.state.currentUser.email;
          }

          firebase
            .database()
            .ref(`/InterviewRequests/${newInterviewRequestID}`)
            .update({
              LoggedUserId: LoggedUserId,
              LoggedUserName: LoggedUserName,
              LoggedCreatedByUserEmail: LoggedCreatedByUserEmail,
              Name: thisVM.name,
              Email: thisVM.email,
              WhatsApp: thisVM.whatsAppNumber,
              MelhoresDiasSemana: thisVM.diasSemana,
              URLVaga: thisVM.URLVaga,
              linkedInURL: thisVM.linkedInURL,
              situacaoProfissional: thisVM.situacaoProfissional,
              infoAdicional: thisVM.infoAdicional,
              consentimentoPrivacidade: thisVM.consentimentoPrivacidade,
              InviterCode: thisVM.InviterCode,
            })
            .then(function () {
              thisVM.$buefy.dialog.alert({
                message: `Obrigado! Voc√™ deve ter recebido um e-mail de confirma√ß√£o de seu interesse e agora vamos deixar nossos robozinhos acharem uma data que caiba dentro das suas prefer√™ncias ü§ñ! `,
                onConfirm: () => {
                  thisVM.$router.replace({
                    name: "Sobre",
                  });
                },
              });
            });
        }
      }
    },
    clearAgenda() {
      this.availableAgenda.splice(0, this.availableAgenda.length);
    },
    // load() {
    //   var thisVM = this;
    //   var interviewAgendaRef = firebase.database().ref(`/InterviewAgenda`);
    //   thisVM.$store.commit("startLoading");
    //   interviewAgendaRef.on("value", function (snapshot) {
    //     thisVM.clearAgenda();

    //     snapshot.forEach(function (childSnapshot) {
    //       var childData = childSnapshot.val();

    //       if (childSnapshot.key != "_count") {
    //         thisVM.availableAgenda.push({
    //           id: childSnapshot.key,
    //           Data: childData.Data,
    //         });
    //       }
    //     });
    //     thisVM.$buefy.toast.open(`Agenda carregada`);

    //     thisVM.$store.commit("stopLoading");
    //     //thisVM.$root.stopLoading();
    //   });
    // },
  },
};
</script>